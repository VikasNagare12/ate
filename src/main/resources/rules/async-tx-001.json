{
  "id": "ASYNC-TX-001",
  "name": "Async Transaction Context Loss",
  "description": "You are checking for lost transaction contexts in asynchronous methods. A violation occurs when a method annotated with @Async calls a method annotated with @Transactional (or relies on an existing transaction). Since @Async runs in a new thread, the thread-local transaction context is lost. To fix this, the @Async method itself or the called method must start a *new* transaction explicitly.",
  "severity": "ERROR",
  "category": "ASYNC_SAFETY",
  "isEnabled": true,
  "detection": {
    "entryPoints": {
      "annotations": [
        "org.springframework.scheduling.annotation.Async"
      ],
      "types": [],
      "methodPatterns": []
    },
    "sinks": {
      "annotations": [
        "org.springframework.transaction.annotation.Transactional"
      ],
      "types": [],
      "methodPatterns": []
    },
    "pathConstraints": {
      "mustContain": [],
      "mustNotContain": [],
      "maxDepth": 1
    }
  },
  "remediation": {
    "quickFix": "If you need transactions in async methods, add @Transactional to the async method itself (it will start a new transaction)",
    "explanation": "Spring's @Transactional uses ThreadLocal to store transaction context. @Async runs in a different thread pool, so the context is not available.",
    "references": [
      "https://docs.spring.io/spring-framework/reference/integration/scheduling.html"
    ]
  }
}
