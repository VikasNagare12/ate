{
  "id": "REMOTE-RETRY-001",
  "name": "No Retry on Non-Idempotent Remote Calls",
  "description": "You are ensuring checking that retries are safe. A violation occurs if a remote call (HTTP, messaging) is annotated with @Retryable but valid idempotency is not guaranteed. Retrying non-idempotent calls (like POST) can cause duplicate data creation. If the method is a POST/PUT, warn about potential duplication unless idempotency keys are used.",
  "severity": "CRITICAL",
  "category": "RETRY_SAFETY",
  "isEnabled": true,
  "detection": {
    "entryPoints": {
      "annotations": [
        "org.springframework.retry.annotation.Retryable",
        "io.github.resilience4j.retry.annotation.Retry",
        "io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker"
      ],
      "types": [],
      "methodPatterns": []
    },
    "sinks": {
      "annotations": [],
      "types": [
        "org.springframework.web.client.RestTemplate",
        "org.springframework.web.reactive.function.client.WebClient",
        "java.net.http.HttpClient",
        "org.springframework.kafka.core.KafkaTemplate"
      ],
      "methodPatterns": []
    },
    "pathConstraints": {
      "mustContain": [],
      "mustNotContain": [],
      "maxDepth": 30
    }
  },
  "remediation": {
    "quickFix": "Remove @Retryable or implement idempotent keys/deduplication on the remote side",
    "explanation": "If a remote call is retried due to a timeout, the original request might have already been processed, leading to a duplicate operation. Use idempotency keys for safe retries.",
    "references": [
      "https://microservices.io/patterns/communication-style/idempotent-consumer.html"
    ]
  }
}
